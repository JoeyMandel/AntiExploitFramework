local RootFolder = script:FindFirstAncestor("AntiExploitModule")
local Config = require(RootFolder.Modules.Config)

local SPEED_TOLERANCE = Config.SpeedTolerance

local SpeedCheck = {}

function SpeedCheck:Check(playerObj)
	local playerPhysics = playerObj.Physics
	local player = playerObj.Player

	local passed = true
	local returnMessage = ""
		
	local distance = math.floor(((playerPhysics.CurrentCFrame.Position - playerPhysics.LastCFrame.Position) * Vector3.new(1,0,1)).Magnitude)
	local diffTime = (tick() - playerObj.LastStepped)
	local horizontalSpeed = distance/diffTime

	
	if horizontalSpeed >= SPEED_TOLERANCE then
		passed = false
		playerPhysics.IgnoreNextCFrame = true
		
		returnMessage = string.format("%s was going too fast...", player.Name)
	end

	return passed, returnMessage
end

function SpeedCheck:Punish(playerObj)
	local playerPhysics = playerObj.Physics
	playerPhysics.Root.Velocity = Vector3.new(0,0,0)
	playerObj.Player.Character:SetPrimaryPartCFrame(playerObj.Physics.LastCFrame)
end

return SpeedCheck
